{% extends "base.html" %}

{% block content %}
  <div class="content-inner">
    <section class="schedule-header">
      <div class="title">Availability â€” {{ employee.name }}</div>
      <div class="subtitle">Role: {{ role }}. Toggle allowed shifts per day. Also set seniority and preferred shift.</div>
      <div class="actions">
        <a class="btn ghost" href="/admin/employees">Back to Employees</a>
      </div>
    </section>

    <div style="margin-bottom:8px; display:flex; gap:8px; flex-wrap:wrap;">
      {% if allowed_roles %}
        {% for rn in allowed_roles %}
          <a class="btn {% if rn == role %}secondary{% else %}ghost{% endif %}" href="{{ url_for('employee_availability', eid=employee.id, role=rn) }}">{{ rn }}</a>
        {% endfor %}
      {% endif %}
    </div>

    <form method="post" action="{{ url_for('employee_availability', eid=employee.id, role=role) }}">
      <div class="table-card">
        <div class="table-title">Weekly Availability</div>
        <div class="schedule-table availability" role="table" aria-label="Availability">
          <div class="row header" role="row" style="grid-template-columns: 160px repeat({{ variants|length }}, minmax(110px, 1fr));">
            <div class="cell head sticky" role="columnheader">Day</div>
            {% for v in variants %}
              <div class="cell head" role="columnheader">{{ v }}</div>
            {% endfor %}
          </div>
          {% for d in days %}
            <div class="row" role="row" style="grid-template-columns: 160px repeat({{ variants|length }}, minmax(110px, 1fr));">
              <div class="cell sticky" role="rowheader">{{ d.label }}</div>
              {% for v in variants %}
                {% set checked = (d.idx, v) in existing %}
                <div class="cell" role="cell">
                  <label class="switch sm" title="Toggle availability">
                    <input type="checkbox" name="avail" value="{{ d.idx }}::{{ v }}" {% if checked %}checked{% endif %} />
                    <span class="slider"></span>
                  </label>
                </div>
              {% endfor %}
            </div>
          {% endfor %}
        </div>
      </div>

      <div class="table-card" style="margin-top:16px;">
        <div class="table-title">Other Information</div>
        <div style="padding: 12px 16px; display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
          <label>
            <div style="font-weight:600; margin-bottom:6px;">Seniority</div>
            <input type="number" min="0" step="1" name="seniority" value="{{ employee.seniority or '' }}" style="width:100%;padding:6px;border:1px solid #e2e8f0;border-radius:6px;" />
          </label>
          <label>
            <div style="font-weight:600; margin-bottom:6px;">Preferred Shift</div>
            <select name="preferred_shift" class="shift-select">
              <option value="">-- none --</option>
              {% for v in variants %}
                <option value="{{ v }}" {% if employee.preferred_shift == v %}selected{% endif %}>{{ v }}</option>
              {% endfor %}
            </select>
          </label>
          <label>
            <div style="font-weight:600; margin-bottom:6px;">Preferred Shifts / Week</div>
            <input type="number" min="0" step="1" name="preferred_shifts_per_week" value="{{ employee.preferred_shifts_per_week or '' }}" style="width:100%;padding:6px;border:1px solid #e2e8f0;border-radius:6px;" />
          </label>
          <label>
            <div style="font-weight:600; margin-bottom:6px;">Max Shifts / Week</div>
            <input type="number" min="0" step="1" name="max_shifts_per_week" value="{{ employee.max_shifts_per_week or '' }}" style="width:100%;padding:6px;border:1px solid #e2e8f0;border-radius:6px;" />
          </label>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px;">
        <button class="btn primary" type="submit">Save</button>
        <a class="btn ghost" href="/admin/employees">Cancel</a>
      </div>
    </form>
  </div>
{% endblock %}
